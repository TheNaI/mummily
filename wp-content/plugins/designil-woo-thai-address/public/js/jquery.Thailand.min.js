!function(e){e.Thailand=function(t){"use strict";t=e.extend({database:"../database/db.json",database_type:"auto",zip_worker_path:!1,autocomplete_size:20,onLoad:function(){},onDataFill:function(){},type:!1,$district:!1,$district_code:!1,$amphoe:!1,$amphoe_code:!1,$province:!1,$province_code:!1,$zipcode:!1,$search:!1},t);var a=function(e){var t,a=[],n=[],i=[],o=!1;return e.lookup&&e.words&&(o=!0,a=e.lookup.split("|"),n=e.words.split("|"),e=e.data),t=function(e){function t(e){var t=e.charCodeAt(0);return n[97>t?t-65:26+t-97]}return o?("number"==typeof e&&(e=a[e]),e.replace(/[A-Z]/gi,t)):e},e[0].length?(e.map(function(e){var a=1;3===e.length&&(a=2),e[a].map(function(n){n[a].map(function(o){o[a]=o[a]instanceof Array?o[a]:[o[a]],o[a].map(function(r){var c={district:t(o[0]),amphoe:t(n[0]),province:t(e[0]),zipcode:r};2===a&&(c.district_code=o[1]||!1,c.amphoe_code=n[1]||!1,c.province_code=e[1]||!1),i.push(c)})})})}),i):e},n=function(e,t,a){e+="",t+="";var i,o,r,c,s=0,p=0,d=0,l=e.length,h=t.length;for(i=0;l>i;i+=1)for(o=0;h>o;o+=1){for(r=0;l>i+r&&h>o+r&&e.charAt(i+r)===t.charAt(o+r);)r+=1;r>d&&(d=r,s=i,p=o)}return c=d,c&&(s&&p&&(c+=n(e.substr(0,p),t.substr(0,p),!1)),l>s+d&&h>p+d&&(c+=n(e.substr(s+d,l-s-d),t.substr(p+d,h-p-d),!1))),a===!1?c:e===t?100:l>h?Math.floor(c/l*100):Math.floor(c/h*100)},i=function(n){var i,o=t.database_type.toLowerCase();switch("json"!==o&&"zip"!==o&&(o=t.database.split(".").pop()),o){case"json":e.getJSON(t.database,function(e){n(new JQL(a(e)))}).fail(function(e){throw new Error('File "'+t.database+'" is not exists.')});break;case"zip":t.zip_worker_path||e("script").each(function(){var e=this.src.split("/"),t=e.pop();"zip.js"===t&&(zip.workerScriptsPath=e.join("/")+"/")}),i=new XMLHttpRequest,i.responseType="blob",i.onreadystatechange=function(){if(4===i.readyState){if(200!==i.status)throw new Error('File "'+t.database+'" is not exists.');zip.createReader(new zip.BlobReader(i.response),function(e){e.getEntries(function(e){e[0].getData(new zip.BlobWriter,function(e){var t=new FileReader;t.onload=function(){n(new JQL(a(JSON.parse(t.result))))},t.readAsText(e)})})})}},i.open("GET",t.database),i.send();break;default:throw new Error('Unknown database type: "'+t.database_type+'". Please define database_type explicitly (json or zip)')}};i(function(a){var i,o,r,c,s={empty:" ",suggestion:function(e){return e.zipcode&&(e.zipcode=" » "+e.zipcode),"<div>"+e.district+" » "+e.amphoe+" » "+e.province+e.zipcode+"</div>"}},p=function(a,n){for(i in t)o=i.replace("$",""),i.indexOf("$")>-1&&t.hasOwnProperty(i)&&t[i]&&n[o]&&t[i].typeahead("val",n[o]).trigger("change");"billing"==t.type?c="billing_state":"shipping"==t.type&&(c="shipping_state"),n.province&&c&&(r=e("#"+c+' option:contains("'+n.province+'")'),r[0].value&&e("#"+c).val(r[0].value).trigger("change")),"function"==typeof t.onDataFill&&(delete n.likely,t.onDataFill(n))};for(i in t)i.indexOf("$")>-1&&"$search"!==i&&t.hasOwnProperty(i)&&t[i]&&t[i].typeahead({hint:!0,highlight:!0,minLength:1},{limit:t.autocomplete_size,templates:s,source:function(e,t){var n=[],i=this.$el.data("field");try{n=a.select("*").where(i).match("^"+e).orderBy(i).fetch()}catch(o){}t(n)},display:function(e){return e[this.$el.data("field")]}}).parent().find(".tt-dataset").data("field",i.replace("$",""));t.$search&&t.$search.typeahead({hint:!0,highlight:!0,minLength:2},{limit:t.autocomplete_size,templates:s,source:function(e,t){var i,o=[];try{o=new JQL(o.concat(a.select("*").where("district").match(e).fetch()).concat(a.select("*").where("amphoe").match(e).fetch()).concat(a.select("*").where("province").match(e).fetch()).concat(a.select("*").where("zipcode").match(e).fetch()).filter(function(e,t,a){for(i=0;i<a.length;i+=1)if(t!==i&&a[i].amphoe===e.amphoe&&a[i].district===e.district)return!1;return!0}).map(function(t){return t.likely=[5*n(e,t.district),3*n(e,t.amphoe.replace(/^เมือง/,"")),n(e,t.province),n(e,t.zipcode)].reduce(function(e,t){return Math.max(e,t)}),t})).select("*").orderBy("likely desc").fetch()}catch(r){}t(o)},display:function(e){return""}});for(i in t)i.indexOf("$")>-1&&t.hasOwnProperty(i)&&t[i]&&t[i].bind("typeahead:select typeahead:autocomplete",p).blur(function(){this.value||e(this).parent().find(".tt-dataset").html("")});"function"==typeof t.onLoad&&t.onLoad(),"function"==typeof t.onComplete&&t.onComplete()})}}(jQuery);